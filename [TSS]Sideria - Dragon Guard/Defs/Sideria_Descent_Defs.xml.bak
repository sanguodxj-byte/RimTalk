<?xml version="1.0" encoding="utf-8" ?>
<Defs>
  <!--
    =====================================================
    ⭐ Sideria 降临系统完整定义
    ⭐ 包含：降临实体、战斗系统、思维树
    =====================================================
  -->

  <!-- ==================== 自定义肉体类型 (规避机械师系统限制) ==================== -->
  <FleshTypeDef>
    <defName>TSS_SideriaFlesh</defName>
    <corpseCategory>CorpsesMechanoid</corpseCategory>
    <damageEffecter>Damage_HitMechanoid</damageEffecter>
    <genericWounds>
      <li><texture>Things/Pawn/Wounds/WoundMechA</texture></li>
      <li><texture>Things/Pawn/Wounds/WoundMechB</texture></li>
      <li><texture>Things/Pawn/Wounds/WoundMechC</texture></li>
    </genericWounds>
  </FleshTypeDef>

  <!-- ==================== 渲染树定义 (完整 Human 结构 + 隐形 Worker) ==================== -->
  <!--
    在 RimWorld 1.6 (Odyssey Update) 中，Humanlike 代码存在硬编码问题：
    - 发型生成器、眼球闪烁基因 (Gene_Blink)、装备渲染器在初始化时检查节点的父子层级结构
    - 如果缺少 EyeLeft/EyeRight 等子节点，眨眼逻辑会抛出空引用异常
    
    解决方案：完整复刻 Human 结构，但使用 PawnRenderNodeWorker_Invisible 隐藏所有不需要的节点。
    这样既满足硬编码检查，又确保只有 SideriaBody 节点实际渲染。
  -->
  <PawnRenderTreeDef>
    <defName>Sideria_SingleImage_RenderTree</defName>
    <root Class="PawnRenderNodeProperties_Parent">
      <debugLabel>Root</debugLabel>
      <tagDef>Root</tagDef>
      <children>
        <!-- 主体节点 - 使用自定义渲染类显示全身立绘 -->
        <li>
          <debugLabel>SideriaBody</debugLabel>
          <tagDef>Body</tagDef>
          <workerClass>TheSecondSeat.Sideria.PawnRenderNodeWorker_SideriaBody</workerClass>
          <useRottenColor>false</useRottenColor>
          <children>
            <!-- 装备容器 (身体) - 隐形但保留结构 -->
            <li Class="PawnRenderNodeProperties_Parent">
              <debugLabel>ApparelBody_Hidden</debugLabel>
              <tagDef>ApparelBody</tagDef>
              <workerClass>TheSecondSeat.Sideria.PawnRenderNodeWorker_Invisible</workerClass>
            </li>
            <!-- 头部节点 - 隐形但保留完整结构供硬编码检查 -->
            <li>
              <debugLabel>Head_Hidden</debugLabel>
              <tagDef>Head</tagDef>
              <workerClass>TheSecondSeat.Sideria.PawnRenderNodeWorker_Invisible</workerClass>
              <children>
                <!-- 注意: Skull, EyeLeft, EyeRight, Beard, Hair 不是 TagDef -->
                <!-- 它们只是 debugLabel 标识，不需要 tagDef 属性 -->
                <li>
                  <debugLabel>Skull_Hidden</debugLabel>
                  <workerClass>TheSecondSeat.Sideria.PawnRenderNodeWorker_Invisible</workerClass>
                </li>
                <li>
                  <debugLabel>EyeLeft_Hidden</debugLabel>
                  <workerClass>TheSecondSeat.Sideria.PawnRenderNodeWorker_Invisible</workerClass>
                </li>
                <li>
                  <debugLabel>EyeRight_Hidden</debugLabel>
                  <workerClass>TheSecondSeat.Sideria.PawnRenderNodeWorker_Invisible</workerClass>
                </li>
                <li>
                  <debugLabel>Beard_Hidden</debugLabel>
                  <workerClass>TheSecondSeat.Sideria.PawnRenderNodeWorker_Invisible</workerClass>
                </li>
                <li>
                  <debugLabel>Hair_Hidden</debugLabel>
                  <workerClass>TheSecondSeat.Sideria.PawnRenderNodeWorker_Invisible</workerClass>
                </li>
                <li Class="PawnRenderNodeProperties_Parent">
                  <debugLabel>ApparelHead_Hidden</debugLabel>
                  <tagDef>ApparelHead</tagDef>
                  <workerClass>TheSecondSeat.Sideria.PawnRenderNodeWorker_Invisible</workerClass>
                </li>
              </children>
            </li>
            <!-- 身体纹身 - 隐形（BodyTattoo 也不是 TagDef） -->
            <li>
              <debugLabel>BodyTattoo_Hidden</debugLabel>
              <workerClass>TheSecondSeat.Sideria.PawnRenderNodeWorker_Invisible</workerClass>
            </li>
          </children>
        </li>
      </children>
    </root>
  </PawnRenderTreeDef>

  <!-- ==================== 降临实体种族定义 (完全复制 Koelime Animal 结构) ==================== -->
  <!-- 抽象基类，与 Koelime 保持一致 -->
  <ThingDef ParentName="BasePawn" Name="SideriaAnimalBase" Abstract="True">
    <statBases>
      <ToxicResistance>1</ToxicResistance>
    </statBases>
    <race>
      <thinkTreeMain>Animal</thinkTreeMain>
      <thinkTreeConstant>AnimalConstant</thinkTreeConstant>
      <hasGenders>false</hasGenders>
      <nameGenerator>NamerAnimalGenericFemale</nameGenerator>
      <bloodDef>Filth_Blood</bloodDef>
      <bloodSmearDef>Filth_BloodSmear</bloodSmearDef>
      <canBecomeShambler>false</canBecomeShambler>
      <renderTree>Sideria_SingleImage_RenderTree</renderTree>
      <hediffGiverSets>
        <!-- 留空避免问题 -->
      </hediffGiverSets>
    </race>
    <thingCategories>
      <li>Animals</li>
    </thingCategories>
    <recipes>
      <li>ExciseCarcinoma</li>
      <li>AdministerMechSerumHealer</li>
      <li>Anesthetize</li>
      <li>CureScaria</li>
      <li MayRequire="Ludeon.RimWorld.Royalty">CureBloodRot</li>
      <li MayRequire="Ludeon.RimWorld.Biotech">TerminatePregnancy</li>
      <li MayRequire="Ludeon.RimWorld.Anomaly">SurgicalInspection</li>
      <li MayRequire="Ludeon.RimWorld.Odyssey">RemovePorcupineQuill</li>
    </recipes>
    <comps>
      <li Class="CompProperties_HoldingPlatformTarget" MayRequire="Ludeon.RimWorld.Anomaly">
        <baseEscapeIntervalMtbDays>120</baseEscapeIntervalMtbDays>
        <getsColdContainmentBonus>true</getsColdContainmentBonus>
      </li>
      <li MayRequire="Ludeon.RimWorld.Anomaly" Class="CompProperties_Studiable">
        <frequencyTicks>120000</frequencyTicks>
        <knowledgeCategory MayRequire="Ludeon.RimWorld.Anomaly">Basic</knowledgeCategory>
        <anomalyKnowledge>1</anomalyKnowledge>
        <requiresImprisonment>true</requiresImprisonment>
        <minMonolithLevelForStudy>1</minMonolithLevelForStudy>
      </li>
    </comps>
  </ThingDef>

  <!-- 具体实现类，继承自抽象基类 -->
  <ThingDef ParentName="SideriaAnimalBase">
    <defName>Sideria_DescentRace</defName>
    <label>Sideria 'Dragon Guard' Descent Form</label>
    <description>The physical manifestation of Sideria, the Dragon Guard. A divine being walking among mortals, wielding the power of the dragon bloodline.</description>
    <uiIconScale>1.2</uiIconScale>
    
    <statBases>
      <MarketValue>10000</MarketValue>
      <MoveSpeed>6.5</MoveSpeed>
      <MaxNutrition>10</MaxNutrition>
      <ImmunityGainSpeed>1.5</ImmunityGainSpeed>
      <CarryingCapacity>500</CarryingCapacity>
      <PainShockThreshold>0.9</PainShockThreshold>
      <ComfyTemperatureMin>-200</ComfyTemperatureMin>
      <ComfyTemperatureMax>200</ComfyTemperatureMax>
      <ArmorRating_Sharp>2.00</ArmorRating_Sharp>
      <ArmorRating_Blunt>1.80</ArmorRating_Blunt>
      <ArmorRating_Heat>1.50</ArmorRating_Heat>
      <PsychicSensitivity>2.0</PsychicSensitivity>
      <Flammability>0</Flammability>
      <ToxicResistance>1</ToxicResistance>
      <VacuumResistance MayRequire="Ludeon.RimWorld.Odyssey">1</VacuumResistance>
    </statBases>
    
    <tools>
      <li>
        <label>left claw</label>
        <labelNoLocation>claw</labelNoLocation>
        <capacities>
          <li>Scratch</li>
        </capacities>
        <power>35</power>
        <armorPenetration>0.4</armorPenetration>
        <cooldownTime>1</cooldownTime>
        <linkedBodyPartsGroup>FrontLeftPaw</linkedBodyPartsGroup>
        <extraMeleeDamages>
          <li><def>Sideria_Bleed_Damage</def><amount>10</amount></li>
        </extraMeleeDamages>
      </li>
      <li>
        <label>right claw</label>
        <labelNoLocation>claw</labelNoLocation>
        <capacities>
          <li>Scratch</li>
        </capacities>
        <power>35</power>
        <armorPenetration>0.4</armorPenetration>
        <cooldownTime>1</cooldownTime>
        <linkedBodyPartsGroup>FrontRightPaw</linkedBodyPartsGroup>
        <extraMeleeDamages>
          <li><def>Sideria_Bleed_Damage</def><amount>10</amount></li>
        </extraMeleeDamages>
      </li>
      <li>
        <capacities>
          <li>Bite</li>
        </capacities>
        <power>50</power>
        <armorPenetration>0.4</armorPenetration>
        <cooldownTime>2</cooldownTime>
        <linkedBodyPartsGroup>Teeth</linkedBodyPartsGroup>
      </li>
      <li>
        <label>rush</label>
        <capacities>
          <li>Blunt</li>
        </capacities>
        <power>15</power>
        <armorPenetration>0.8</armorPenetration>
        <cooldownTime>3</cooldownTime>
      </li>
      <li>
        <label>tail</label>
        <capacities>
          <li>Blunt</li>
        </capacities>
        <power>30</power>
        <armorPenetration>0.6</armorPenetration>
        <cooldownTime>3</cooldownTime>
      </li>
    </tools>
    
    <race>
      <body>QuadrupedAnimalWithPawsAndTail</body>
      <packAnimal>false</packAnimal>
      <baseHungerRate>0</baseHungerRate>
      <baseBodySize>4.0</baseBodySize>
      <baseHealthScale>6</baseHealthScale>
      <foodType>None</foodType>
      <leatherDef IsNull="true" />
      <hasMeat>false</hasMeat>
      <trainability>None</trainability>
      <lifeExpectancy>10000</lifeExpectancy>
      <neverIncludeInQuests>true</neverIncludeInQuests>
      <fleshType>TSS_SideriaFlesh</fleshType>
      <needsRest>false</needsRest>
      <predator>false</predator>
      <manhunterOnDamageChance>0</manhunterOnDamageChance>
      <manhunterOnTameFailChance>0</manhunterOnTameFailChance>
      <lifeStageAges>
        <li>
          <def>AnimalBaby</def>
          <minAge>0</minAge>
        </li>
        <li>
          <def>AnimalJuvenile</def>
          <minAge>0.3333</minAge>
        </li>
        <li>
          <def>AnimalAdult</def>
          <minAge>0.6666</minAge>
          <soundWounded>Pawn_Thrumbo_Pain</soundWounded>
          <soundDeath>Pawn_Thrumbo_Death</soundDeath>
          <soundCall>Pawn_Thrumbo_Call</soundCall>
          <soundAngry>Pawn_Thrumbo_Angry</soundAngry>
        </li>
      </lifeStageAges>
      <soundMeleeHitPawn>Pawn_Melee_BigBash_HitPawn</soundMeleeHitPawn>
      <soundMeleeHitBuilding>Pawn_Melee_BigBash_HitBuilding</soundMeleeHitBuilding>
      <soundMeleeMiss>Pawn_Melee_BigBash_Miss</soundMeleeMiss>
      <soundEating>Herbivore_Eat</soundEating>
      <headPosPerRotation>
        <li>(0.0, 0, 0.14)</li>
        <li>(0.31, 0, -0.03)</li>
        <li>(0.0, 0, -0.02)</li>
        <li>(-0.31, 0, -0.03)</li>
      </headPosPerRotation>
    </race>

    <inspectorTabs>
      <li>ITab_Pawn_Health</li>
      <li>ITab_Pawn_Needs</li>
      <li>ITab_Pawn_Character</li>
      <li>ITab_Pawn_Log</li>
    </inspectorTabs>

    <!-- 直接添加征召组件 -->
    <comps>
      <li Class="TheSecondSeat.Components.CompProperties_DraftableAnimal" />
    </comps>
  </ThingDef>

  <!-- ==================== 降临实体 PawnKindDef (完全复制 Koelime 结构) ==================== -->
  <PawnKindDef ParentName="AnimalKindBase">
    <defName>TSS_Sideria_Avatar</defName>
    <label>Sideria 'Dragon Guard'</label>
    <description>The physical manifestation of Sideria, the Dragon Guard. A divine being walking among mortals, wielding the power of the dragon bloodline.</description>
    <race>Sideria_DescentRace</race>
    <combatPower>9999</combatPower>
    <ecoSystemWeight>0</ecoSystemWeight>
    <lifeStages>
      <!-- 三个生命阶段，与 ThingDef 的 lifeStageAges 对应 -->
      <li>
        <bodyGraphicData>
          <texPath>Sideria/Narrators/base</texPath>
          <graphicClass>TheSecondSeat.Sideria.Graphic_SideriaAnimal</graphicClass>
          <drawSize>1.8</drawSize>
          <shadowData>
            <volume>(0.4, 0.3, 0.3)</volume>
            <offset>(0,0,-0.2)</offset>
          </shadowData>
        </bodyGraphicData>
        <dessicatedBodyGraphicData>
          <texPath>Things/Pawn/Animal/Dessicated_Large</texPath>
          <drawSize>1.8</drawSize>
        </dessicatedBodyGraphicData>
      </li>
      <li>
        <bodyGraphicData>
          <texPath>Sideria/Narrators/base</texPath>
          <graphicClass>TheSecondSeat.Sideria.Graphic_SideriaAnimal</graphicClass>
          <drawSize>2.6</drawSize>
          <shadowData>
            <volume>(0.6, 0.45, 0.45)</volume>
            <offset>(0,0,-0.25)</offset>
          </shadowData>
        </bodyGraphicData>
        <dessicatedBodyGraphicData>
          <texPath>Things/Pawn/Animal/Dessicated_Large</texPath>
          <drawSize>2.6</drawSize>
        </dessicatedBodyGraphicData>
      </li>
      <li>
        <bodyGraphicData>
          <texPath>Sideria/Narrators/base</texPath>
          <graphicClass>TheSecondSeat.Sideria.Graphic_SideriaAnimal</graphicClass>
          <drawSize>3.8</drawSize>
          <shadowData>
            <volume>(0.8, 0.6, 0.6)</volume>
            <offset>(0,0,-0.3)</offset>
          </shadowData>
        </bodyGraphicData>
        <dessicatedBodyGraphicData>
          <texPath>Things/Pawn/Animal/Dessicated_Large</texPath>
          <drawSize>3.8</drawSize>
        </dessicatedBodyGraphicData>
      </li>
    </lifeStages>
    <canArriveManhunter>false</canArriveManhunter>
    <startingHediffs>
      <li>
        <def>Sideria_DivineBody</def>
        <chance>1</chance>
      </li>
    </startingHediffs>
  </PawnKindDef>

  <!-- ==================== 技能定义 ==================== -->
  <AbilityDef>
    <defName>Sideria_Skill_BloodNova</defName>
    <label>Blood Nova</label>
    <description>Unleashes a burst of corrupted energy.</description>
    <iconPath>UI/Narrators/Descent/Effects/Aura</iconPath>
    <cooldownTicksRange>600</cooldownTicksRange>
    <targetRequired>False</targetRequired>
    <verbProperties>
      <verbClass>Verb_CastAbility</verbClass>
      <range>15.9</range>
      <targetParams><canTargetSelf>True</canTargetSelf></targetParams>
    </verbProperties>
    <comps>
      <li Class="CompProperties_AbilityLaunchProjectile">
        <projectileDef>Sideria_BloodNova_Proj</projectileDef>
      </li>
    </comps>
  </AbilityDef>

  <ThingDef ParentName="BaseBullet">
    <defName>Sideria_BloodNova_Proj</defName>
    <label>blood nova</label>
    <graphicData>
      <texPath>Things/Projectile/Bullet_Small</texPath>
      <graphicClass>Graphic_Single</graphicClass>
      <shaderType>Transparent</shaderType>
      <color>(255, 0, 0, 255)</color>
    </graphicData>
    <projectile>
      <damageDef>Sideria_Bleed_Damage</damageDef>
      <damageAmountBase>25</damageAmountBase>
      <speed>100</speed>
      <explosionRadius>5.9</explosionRadius>
      <postExplosionSpawnThingDef>Filth_Blood</postExplosionSpawnThingDef>
    </projectile>
  </ThingDef>

  <AbilityDef>
    <defName>Sideria_Skill_TitanGrasp</defName>
    <label>Titan Grasp</label>
    <description>Crushes a single target.</description>
    <iconPath>UI/Narrators/Descent/Effects/Aura</iconPath>
    <cooldownTicksRange>1200</cooldownTicksRange>
    <verbProperties>
      <verbClass>Verb_CastAbility</verbClass>
      <range>24.9</range>
      <targetParams><canTargetPawns>True</canTargetPawns></targetParams>
    </verbProperties>
    <comps>
      <li Class="CompProperties_AbilityEffect">
        <compClass>CompAbilityEffect_Stun</compClass>
        <goodwillImpact>-30</goodwillImpact>
      </li>
    </comps>
  </AbilityDef>

  <!-- ==================== Hediff Giver Set (保留) ==================== -->
  <HediffGiverSetDef>
    <defName>Sideria_Innate_Givers</defName>
    <hediffGivers>
      <li Class="HediffGiver_Birthday">
        <hediff>Sideria_DivineBody</hediff>
      </li>
      <li Class="HediffGiver_Birthday">
        <hediff>MechlinkImplant</hediff>
      </li>
    </hediffGivers>
  </HediffGiverSetDef>

  <!-- ==================== 神性躯体 ==================== -->
  <HediffDef>
    <defName>Sideria_DivineBody</defName>
    <label>神性躯体</label>
    <description>Sideria 的神性构造赋予了她超越常理的抗性和力量，并解锁了龙血技能。</description>
    <hediffClass>HediffWithComps</hediffClass>
    <defaultLabelColor>(0.8, 0.8, 1.0)</defaultLabelColor>
    <isBad>false</isBad>
    <comps>
      <!-- 通过 Hediff 赋予技能 (使用 abilityDefs 列表一次性赋予多个) -->
      <li Class="HediffCompProperties_GiveAbility">
        <abilityDefs>
          <li>Sideria_Skill_BloodNova</li>
          <li>Sideria_Skill_TitanGrasp</li>
          <li>Sideria_Skill_SummonBloodThorn</li>
          <li>Sideria_Skill_SummonRadiant</li>
        </abilityDefs>
      </li>
    </comps>
    <stages>
      <li>
        <statOffsets>
          <MeleeDamageFactor>2.0</MeleeDamageFactor>
          <MeleeHitChance>10.0</MeleeHitChance>
          <MeleeDodgeChance>5.0</MeleeDodgeChance>
          <ShootingAccuracyPawn>10.0</ShootingAccuracyPawn>
        </statOffsets>
        <makeImmuneTo>
          <li>Hypothermia</li>
          <li>Heatstroke</li>
          <li>ToxicBuildup</li>
          <li>Scaria</li>
          <li>Flu</li>
          <li>Plague</li>
          <li>Malaria</li>
          <li>SleepingSickness</li>
          <li>WoundInfection</li>
          <li>FoodPoisoning</li>
          <li>CryptosleepSickness</li>
        </makeImmuneTo>
      </li>
    </stages>
  </HediffDef>

  <!-- ==================== 猩红绽放 Hediff (保留) ==================== -->
  <HediffDef>
    <defName>Sideria_ScarletBloom_BuildUp</defName>
    <label>猩红绽放</label>
    <description>猩红色的能量正在侵蚀目标的生命本质。叠加至3层时，目标将迎来终结。</description>
    <hediffClass>HediffWithComps</hediffClass>
    <defaultLabelColor>(0.8, 0.0, 0.0)</defaultLabelColor>
    <lethalSeverity>1.0</lethalSeverity>
    <comps>
      <li Class="HediffCompProperties_SeverityPerDay">
        <severityPerDay>-0.5</severityPerDay>
      </li>
      <li Class="TheSecondSeat.Components.HediffCompProperties_Stacker">
        <maxStacks>3</maxStacks>
        <severityPerStack>0.33</severityPerStack>
        <displayStackCount>true</displayStackCount>
        <onMaxStacks>Kill</onMaxStacks>
      </li>
    </comps>
    <stages>
      <li>
        <minSeverity>0.0</minSeverity>
        <label>一之型</label>
      </li>
      <li>
        <minSeverity>0.33</minSeverity>
        <label>二之型</label>
      </li>
      <li>
        <minSeverity>0.66</minSeverity>
        <label>三之型·终焉</label>
        <lifeThreatening>true</lifeThreatening>
      </li>
    </stages>
  </HediffDef>

  <!-- ==================== 猩红绽放 Damage (重命名为 Sideria_Bleed_Damage) ==================== -->
  <DamageDef>
    <defName>Sideria_Bleed_Damage</defName>
    <label>猩红侵蚀</label>
    <workerClass>DamageWorker_AddGlobal</workerClass>
    <externalViolence>false</externalViolence>
    <deathMessage>{0} 已被猩红绽放吞噬。</deathMessage>
    <hediff>Sideria_ScarletBloom_BuildUp</hediff>
    <hediffSolid>Sideria_ScarletBloom_BuildUp</hediffSolid>
    <defaultDamage>0</defaultDamage>
    <harmAllLayersUntilOutside>true</harmAllLayersUntilOutside>
    <impactSoundType>Toxic</impactSoundType>
    <armorCategory>Heat</armorCategory>
  </DamageDef>

  <!-- ==================== 龙的思维树 (自动攻击) ==================== -->
  <ThinkTreeDef>
    <defName>Sideria_Dragon_ThinkTree</defName>
    <thinkRoot Class="ThinkNode_Priority">
      <subNodes>
        <li Class="ThinkNode_Subtree">
          <treeDef>Downed</treeDef>
        </li>
        <li Class="ThinkNode_Subtree">
          <treeDef>LordDuty</treeDef>
        </li>
        <li Class="JobGiver_AIFightEnemies">
          <targetAcquireRadius>500</targetAcquireRadius>
          <targetKeepRadius>500</targetKeepRadius>
        </li>
        <li Class="JobGiver_WanderAnywhere">
          <maxDanger>Deadly</maxDanger>
        </li>
      </subNodes>
    </thinkRoot>
  </ThinkTreeDef>

  <!-- ==================== 血棘龙 (BloodThorn Dragon) ==================== -->
  <ThingDef ParentName="BasePawn">
    <defName>Sideria_BloodThornDragon_Race</defName>
    <label>BloodThorn Dragon</label>
    <description>A construct of blood and thorns, summoned by Sideria.</description>
    <statBases>
      <MarketValue>0</MarketValue>
      <MoveSpeed>5.0</MoveSpeed>
      <ArmorRating_Sharp>0.8</ArmorRating_Sharp>
      <ArmorRating_Blunt>0.5</ArmorRating_Blunt>
      <ComfyTemperatureMin>-100</ComfyTemperatureMin>
      <ComfyTemperatureMax>100</ComfyTemperatureMax>
    </statBases>
    <race>
      <thinkTreeMain>Sideria_Dragon_ThinkTree</thinkTreeMain>
      <intelligence>Animal</intelligence>
      <fleshType>TSS_SideriaFlesh</fleshType>
      <needsRest>false</needsRest>
      <foodType>None</foodType>
      <trainability>None</trainability>
      <lifeExpectancy>100</lifeExpectancy>
      <hasGenders>false</hasGenders>
      <body>QuadrupedAnimalWithPawsAndTail</body>
      <baseBodySize>2.0</baseBodySize>
      <baseHealthScale>3.0</baseHealthScale>
      <lifeStageAges>
        <li>
          <def>AnimalAdult</def>
          <minAge>0</minAge>
          <soundWounded>Pawn_Mech_Scyther_Wounded</soundWounded>
          <soundDeath>Pawn_Mech_Scyther_Death</soundDeath>
        </li>
      </lifeStageAges>
    </race>
    <tools>
      <li>
        <label>thorn bite</label>
        <capacities><li>Bite</li></capacities>
        <power>20</power>
        <cooldownTime>1.6</cooldownTime>
        <linkedBodyPartsGroup>Teeth</linkedBodyPartsGroup>
        <chanceFactor>0.7</chanceFactor>
      </li>
      <li>
        <label>tail slash</label>
        <capacities><li>Cut</li></capacities>
        <power>15</power>
        <cooldownTime>1.5</cooldownTime>
        <linkedBodyPartsGroup>HeadAttackTool</linkedBodyPartsGroup>
      </li>
    </tools>
    <comps>
      <li Class="TheSecondSeat.Components.CompProperties_DraftableAnimal" />
    </comps>
  </ThingDef>

  <PawnKindDef>
    <defName>Sideria_BloodThornDragon</defName>
    <label>BloodThorn Dragon</label>
    <race>Sideria_BloodThornDragon_Race</race>
    <combatPower>200</combatPower>
    <defaultFactionType>Ancients</defaultFactionType>
    <lifeStages>
      <li>
        <bodyGraphicData>
          <texPath>Sideria/Narrators/Descent/Dragon/BloodThorn</texPath>
          <graphicClass>Graphic_Single</graphicClass>
          <drawSize>3.0</drawSize>
        </bodyGraphicData>
      </li>
    </lifeStages>
  </PawnKindDef>

  <!-- ==================== 煌耀龙 (Radiant Dragon) ==================== -->
  <ThingDef ParentName="BasePawn">
    <defName>Sideria_RadiantDragon_Race</defName>
    <label>Radiant Dragon</label>
    <description>A construct of pure light, summoned by Sideria.</description>
    <statBases>
      <MarketValue>0</MarketValue>
      <MoveSpeed>6.0</MoveSpeed>
      <ArmorRating_Sharp>0.6</ArmorRating_Sharp>
      <ArmorRating_Blunt>0.4</ArmorRating_Blunt>
      <ComfyTemperatureMin>-100</ComfyTemperatureMin>
      <ComfyTemperatureMax>100</ComfyTemperatureMax>
    </statBases>
    <race>
      <thinkTreeMain>Sideria_Dragon_ThinkTree</thinkTreeMain>
      <intelligence>Animal</intelligence>
      <fleshType>TSS_SideriaFlesh</fleshType>
      <needsRest>false</needsRest>
      <foodType>None</foodType>
      <trainability>None</trainability>
      <lifeExpectancy>100</lifeExpectancy>
      <hasGenders>false</hasGenders>
      <body>QuadrupedAnimalWithPawsAndTail</body>
      <baseBodySize>2.0</baseBodySize>
      <baseHealthScale>2.5</baseHealthScale>
      <lifeStageAges>
        <li>
          <def>AnimalAdult</def>
          <minAge>0</minAge>
          <soundWounded>Pawn_Mech_Centipede_Wounded</soundWounded>
          <soundDeath>Pawn_Mech_Centipede_Death</soundDeath>
        </li>
      </lifeStageAges>
    </race>
    <tools>
      <li>
        <label>radiant bite</label>
        <capacities><li>Bite</li></capacities>
        <power>18</power>
        <cooldownTime>1.6</cooldownTime>
        <linkedBodyPartsGroup>Teeth</linkedBodyPartsGroup>
        <chanceFactor>0.7</chanceFactor>
      </li>
      <li>
        <label>light slash</label>
        <capacities><li>Cut</li></capacities>
        <power>14</power>
        <cooldownTime>1.5</cooldownTime>
        <linkedBodyPartsGroup>HeadAttackTool</linkedBodyPartsGroup>
      </li>
    </tools>
    <comps>
      <li Class="TheSecondSeat.Components.CompProperties_DraftableAnimal" />
    </comps>
  </ThingDef>

  <PawnKindDef>
    <defName>Sideria_RadiantDragon</defName>
    <label>Radiant Dragon</label>
    <race>Sideria_RadiantDragon_Race</race>
    <combatPower>200</combatPower>
    <defaultFactionType>Ancients</defaultFactionType>
    <lifeStages>
      <li>
        <bodyGraphicData>
          <texPath>Sideria/Narrators/Descent/Dragon/Radiant</texPath>
          <graphicClass>Graphic_Single</graphicClass>
          <drawSize>3.0</drawSize>
        </bodyGraphicData>
      </li>
    </lifeStages>
  </PawnKindDef>

  <!-- ==================== 召唤技能定义 ==================== -->
  <AbilityDef>
    <defName>Sideria_Skill_SummonBloodThorn</defName>
    <label>Summon: BloodThorn</label>
    <description>Summons a BloodThorn Dragon to fight for you.</description>
    <iconPath>UI/Narrators/Descent/Effects/Aura</iconPath>
    <cooldownTicksRange>3600</cooldownTicksRange>
    <verbProperties>
      <verbClass>Verb_CastAbility</verbClass>
      <range>15.9</range>
      <targetParams><canTargetLocations>True</canTargetLocations></targetParams>
    </verbProperties>
    <comps>
      <li Class="TheSecondSeat.Components.CompProperties_AbilitySummon">
        <pawnKind>Sideria_BloodThornDragon</pawnKind>
        <count>1</count>
        <playerFaction>true</playerFaction>
        <sendLetter>false</sendLetter>
      </li>
    </comps>
  </AbilityDef>

  <AbilityDef>
    <defName>Sideria_Skill_SummonRadiant</defName>
    <label>Summon: Radiant</label>
    <description>Summons a Radiant Dragon to fight for you.</description>
    <iconPath>UI/Narrators/Descent/Effects/Aura</iconPath>
    <cooldownTicksRange>3600</cooldownTicksRange>
    <verbProperties>
      <verbClass>Verb_CastAbility</verbClass>
      <range>15.9</range>
      <targetParams><canTargetLocations>True</canTargetLocations></targetParams>
    </verbProperties>
    <comps>
      <li Class="TheSecondSeat.Components.CompProperties_AbilitySummon">
        <pawnKind>Sideria_RadiantDragon</pawnKind>
        <count>1</count>
        <playerFaction>true</playerFaction>
        <sendLetter>false</sendLetter>
      </li>
    </comps>
  </AbilityDef>

  <!-- ==================== 龙族专属技能 ==================== -->
  
  <!-- 血棘龙：毁灭撕裂 -->
  <AbilityDef>
    <defName>Sideria_Skill_DestructiveRend</defName>
    <label>Destructive Rend</label>
    <description>Tears apart an injured body part of the target, dealing massive damage.</description>
    <iconPath>UI/Narrators/Descent/Effects/Aura</iconPath> <!-- 占位符图标 -->
    <cooldownTicksRange>600</cooldownTicksRange>
    <verbProperties>
      <verbClass>Verb_CastAbility</verbClass>
      <range>1.9</range> <!-- 近战范围 -->
      <targetParams>
        <canTargetPawns>True</canTargetPawns>
        <canTargetBuildings>False</canTargetBuildings>
        <canTargetMechs>True</canTargetMechs>
      </targetParams>
    </verbProperties>
    <comps>
      <li Class="CompProperties_AbilityEffect">
        <compClass>TheSecondSeat.Components.CompAbilityEffect_DestructiveRend</compClass>
      </li>
    </comps>
  </AbilityDef>

  <!-- 煌耀龙：惩罪重击 (金色光束) -->
  <AbilityDef>
    <defName>Sideria_Skill_PunishingStrike</defName>
    <label>Punishing Strike</label>
    <description>Calls down a golden orbital beam to smite the target location.</description>
    <iconPath>UI/Narrators/Descent/Effects/Aura</iconPath> <!-- 占位符图标 -->
    <cooldownTicksRange>1200</cooldownTicksRange>
    <verbProperties>
      <verbClass>Verb_CastAbility</verbClass>
      <range>24.9</range>
      <warmupTime>60</warmupTime> <!-- 1秒引导 (60 ticks) -->
      <targetParams>
        <canTargetLocations>True</canTargetLocations>
      </targetParams>
    </verbProperties>
    <comps>
      <li Class="CompProperties_AbilityEffect">
        <compClass>TheSecondSeat.Components.CompAbilityEffect_GoldenBeam</compClass>
      </li>
    </comps>
  </AbilityDef>

  <!-- 金色光束 ThingDef -->
  <ThingDef ParentName="OrbitalStrikeBase">
    <defName>Sideria_GoldenPowerBeam</defName>
    <label>golden power beam</label>
    <thingClass>PowerBeam</thingClass> <!-- 暂时使用原版类，颜色可能不是金色的 -->
    <comps>
      <li Class="CompProperties_OrbitalBeam">
        <width>10</width>
        <color>(1, 0.9, 0.4, 1)</color> <!-- 尝试通过参数调整颜色 -->
        <sound>OrbitalBeam</sound>
      </li>
    </comps>
  </ThingDef>

  <!-- ==================== 叙事者降临事件定义 ==================== -->
  
  <!-- 友好/中立降临 -->
  <IncidentDef>
    <defName>TSS_NarratorDescent_Friendly</defName>
    <label>narrator descent (friendly)</label>
    <category>Misc</category>
    <targetTags>
      <li>Map_PlayerHome</li>
    </targetTags>
    <workerClass>TheSecondSeat.Storyteller.IncidentWorker_NarratorDescent</workerClass>
    <baseChance>0</baseChance> <!-- 默认不随机触发，由 AI 控制 -->
    <minRefireDays>15</minRefireDays>
    <letterLabel>Narrator Descent</letterLabel>
    <letterText>The narrator has decided to manifest in physical form to assist you.</letterText>
    <letterDef>PositiveEvent</letterDef>
  </IncidentDef>

  <!-- 敌对降临 -->
  <IncidentDef>
    <defName>TSS_NarratorDescent_Hostile</defName>
    <label>narrator descent (hostile)</label>
    <category>ThreatBig</category>
    <targetTags>
      <li>Map_PlayerHome</li>
    </targetTags>
    <workerClass>TheSecondSeat.Storyteller.IncidentWorker_NarratorDescent</workerClass>
    <baseChance>0</baseChance> <!-- 默认不随机触发，由 AI 控制 -->
    <minRefireDays>30</minRefireDays>
    <letterLabel>Narrator Manifestation</letterLabel>
    <letterText>The narrator has manifested in a hostile form to challenge you!</letterText>
    <letterDef>ThreatBig</letterDef>
  </IncidentDef>

</Defs>
