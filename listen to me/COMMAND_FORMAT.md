# 指令格式说明

## 自然语法格式

本 Mod 支持更自然的中文指令格式：

```
[移动动词] + [位置] + [动作] + [对象]
```

### 格式详解

#### 1. 移动动词（可选）
**作用**: 表示要移动到某个位置

**支持的动词**:
- 中文: `去`、`来`、`到`、`前往`、`走到`、`移动到`、`过去`
- 英文: `go`、`goto`、`move to`、`head to`、`walk to`

#### 2. 位置词
**作用**: 指定目标位置

**支持的位置**:
| 位置 | 关键词 |
|------|--------|
| 厨房 | 厨房、炉灶、kitchen、stove |
| 仓库 | 仓库、储藏室、storage、warehouse |
| 医疗室 | 医疗室、病房、hospital、medical |
| 工作台 | 工作台、工作间、workshop、workbench |
| 裁缝台 | 裁缝台、缝纫台、tailor、tailoring |
| 锻造台 | 锻造台、铁匠、forge、smithing |
| 研究台 | 研究台、研究室、research、lab |
| 卧室 | 卧室、寝室、bedroom、sleeping |
| 外面 | 外面、室外、野外、outside |

#### 3. 动作词
**作用**: 指定要执行的动作类型

**支持的动作**:
| 动作类型 | 关键词 |
|---------|--------|
| 工作 | 做、干、工作、干活、做事、劳动 |
| 制作 | 制作、做、生产、制造、加工、合成、造 |
| 战斗 | 攻击、战斗、打、杀、消灭、击杀、战 |
| 建造 | 建造、建、修建、盖、建设、搭建 |
| 搬运 | 搬运、搬、运、拿、取、搬走、运送 |
| 狩猎 | 狩猎、猎、打猎、猎杀 |
| 采集 | 采集、采、收集、收获、采摘 |
| 挖矿 | 挖矿、挖、开采、采矿、挖掘 |
| 医疗 | 治疗、医疗、照顾、救治、看病、医治 |
| 清洁 | 清洁、打扫、清理、扫、清扫 |
| 修理 | 修理、维修、修复、修 |
| 等待 | 等待、等、停、待命、休息、待着 |

#### 4. 对象词（可选）
**作用**: 指定操作的具体对象

**支持的对象**:
| 对象 | 关键词 |
|------|--------|
| 敌人 | 敌人、敌、入侵者、袭击者 |
| 伤员 | 伤员、伤者、病人 |
| 动物 | 动物、野兽、猎物 |
| 植物 | 植物、作物、庄稼 |
| 矿石 | 矿石、矿、石头 |
| 物资 | 物资、物品、东西、材料 |

---

## 指令示例

### ? 推荐格式（自然语法）

#### 移动 + 动作组合
```
去厨房做饭          → 移动到厨房并开始烹饪
到仓库拿木材        → 移动到仓库并搬运木材
前往医疗室治疗伤员   → 移动到医疗室并治疗伤员
去裁缝台制作防尘大衣 → 移动到裁缝台并制作衣服
到锻造台做武器      → 移动到锻造台并制作武器
```

#### 纯移动指令
```
去厨房              → 仅移动到厨房
到外面              → 移动到室外
前往仓库            → 移动到仓库
```

#### 纯动作指令
```
制作防尘大衣        → 在附近工作台制作
攻击敌人            → 攻击最近的敌对单位
治疗伤员            → 治疗附近受伤的小人
清洁                → 清洁附近区域
等待                → 原地待命
```

#### 复杂指令
```
在裁缝台制作3个防尘大衣  → 指定工作台、物品和数量
去外面狩猎动物          → 移动到室外并狩猎
到医疗室照顾病人        → 移动并执行医疗任务
前往工作台做家具        → 移动并制作家具
```

---

## 指令解析优先级

系统按以下顺序解析指令：

1. **检测移动动词** - 是否以"去/来/到/前往"开头
2. **提取位置信息** - 识别目标位置
3. **提取动作类型** - 识别要执行的动作
4. **提取对象信息** - 识别操作对象
5. **提取物品名称** - 对于制作指令，识别物品
6. **提取数量** - 识别"3个"、"五件"等数量词
7. **AI智能分析** - 如果以上都失败，使用智能分析

---

## 高级用法

### 省略部分关键词

系统会智能理解，以下指令都有效：

```
厨房做饭            ? (省略"去")
裁缝台制作衣服      ? (省略"去")
攻击                ? (自动查找敌人)
制作防尘大衣        ? (自动查找工作台)
清洁房间            ?
狩猎                ? (自动查找猎物)
```

### 多种表达方式

同一个意思可以有多种说法：

```
去厨房做饭 = 到厨房干活 = 前往厨房工作 = 厨房做事
制作衣服 = 做衣服 = 生产衣服 = 加工衣服
攻击敌人 = 打敌人 = 杀敌 = 战斗 = 消灭入侵者
```

### 英文指令

也支持英文（但推荐中文）：

```
go to kitchen       → 去厨房
attack enemy        → 攻击敌人
craft duster        → 制作防尘大衣
clean               → 清洁
```

---

## 特殊功能

### 自动目标查找

如果不指定具体目标，系统会自动查找：

- `攻击` → 查找最近的敌人
- `治疗` → 查找最近的伤员
- `狩猎` → 查找最近的可猎杀动物
- `搬运` → 查找最近需要搬运的物品
- `清洁` → 查找最近的污渍
- `挖矿` → 查找最近的矿石

### 工作台智能识别

指令中包含工作台名称时，会优先使用该工作台：

```
裁缝台制作防尘大衣    → 在裁缝台上制作
锻造台做长剑          → 在锻造台上制作
炉灶做饭              → 在炉灶上烹饪
研究台研究            → 在研究台上研究
```

### 数量识别

支持多种数量表达：

```
制作3个木墙           → 数字 3
做五件衣服            → 中文数字 五
生产10个药品          → 数字 10
造两扇门              → 中文数字 二
```

---

## 对话模式

勾选"使用对话模式"后，小人会：

1. **先回应指令** - 根据心情和特质说话
2. **等待几秒** - 增加沉浸感
3. **执行动作** - 开始实际工作

**回应示例**:
- 心情好: "好的，我这就去！"、"没问题！"
- 心情差: "唉，又要干活了..."、"知道了..."
- 特殊情况: "那里有点远啊..."、"我试试看"

---

## 常见问题

### Q: 指令没有反应？
**A**: 
1. 确认小人没有倒下或死亡
2. 尝试更简单的指令如"等待"
3. 查看日志中的 `[ListenToMe]` 消息

### Q: 找不到工作台？
**A**: 
1. 确保工作台已建造完成
2. 工作台要属于己方殖民地
3. 尝试用更具体的名称，如"裁缝台"而不是"台"

### Q: 制作指令不工作？
**A**:
1. 确保有合适的工作台
2. 确保工作台有该配方
3. 确保有足够的材料
4. 尝试先手动添加一次配方

### Q: 支持哪些语言？
**A**: 
- 完整支持: 简体中文
- 基础支持: 英文
- 可扩展: 通过修改代码添加其他语言

---

## 调试技巧

### 启用调试模式
```csharp
ListenToMe.DebugTools.DebugMode = true
```

### 测试指令解析
```csharp
ListenToMe.DebugTools.TestCommandParsing("去厨房做饭", pawn);
```

查看日志会显示：
```
[ListenToMe] Testing command: '去厨房做饭'
[ListenToMe] Parse Result:
  Type: Work
  Target: ElectricStove12345
  Location: IntVec3(50, 0, 30)
```

---

## 开发者信息

### 添加新的位置

编辑 `CommandParser.cs`:

```csharp
private static readonly Dictionary<string, List<string>> LocationKeywords = 
{
    { "你的位置", new List<string> { "关键词1", "关键词2" } }
};
```

### 添加新的动作

```csharp
{ CommandType.YourAction, new List<string> { 
    "动词1", "动词2", "verb1", "verb2" 
}}
```

### 添加新的对象

```csharp
{ "你的对象", new List<string> { "关键词1", "关键词2" } }
```

---

**最后更新**: 2025-11-23  
**版本**: 1.1.0 - 自然语法支持  
**兼容**: RimWorld 1.5
