# v1.1.0 更新说明 - 自然语法支持

## ?? 重大更新

本次更新为 Listen To Me Mod 引入了**自然语法指令系统**，让指令更符合中文表达习惯！

**发布日期**: 2025-11-23  
**版本**: 1.1.0  
**编译状态**: ? 成功  
**DLL 大小**: 50 KB

---

## ? 新增功能

### 1. 自然语法格式
现在支持更自然的中文指令格式：

```
[移动动词] + [位置] + [动作] + [对象]
```

#### 移动动词
- 中文: `去`、`来`、`到`、`前往`、`走到`、`移动到`、`过去`
- 英文: `go`、`goto`、`move to`、`head to`、`walk to`

#### 位置识别
- 厨房、仓库、医疗室、工作台、裁缝台、锻造台、研究台、卧室、外面...
- 自动在地图上查找对应位置

#### 动作识别
- 做、干、工作、制作、建造、搬运、狩猎、采集、挖矿、治疗、清洁、修理...
- 智能识别动作意图

#### 对象识别
- 敌人、伤员、动物、植物、矿石、物资...
- 自动查找最近目标

---

## ?? 指令示例对比

### 旧版本（v1.0.0）
```
制作防尘大衣        → 需要手动选择工作台
攻击                → 只能攻击，不能移动
治疗                → 只能治疗附近的
```

### 新版本（v1.1.0）?
```
去厨房做饭          → 自动移动+开始工作
到仓库拿木材        → 移动到指定位置+搬运
前往医疗室治疗伤员   → 移动+执行医疗任务
在裁缝台制作3个防尘大衣 → 指定工作台+物品+数量
```

---

## ?? 改进内容

### 解析引擎优化
1. **增强位置识别**
   - 新增 9 种预设位置
   - 支持房间角色识别
   - 支持建筑名称匹配

2. **改进动作提取**
   - 更智能的关键词匹配
   - 支持动词+名词组合
   - 优化优先级判断

3. **优化对象查找**
   - 自动查找最近目标
   - 支持模糊匹配
   - 距离优先排序

4. **数量识别增强**
   - 支持阿拉伯数字: `3个`、`10件`
   - 支持中文数字: `三个`、`五件`
   - 支持多种量词: `个`、`件`、`只`、`条`、`张`

---

## ?? 新增文档

### COMMAND_FORMAT.md
详细的指令格式说明文档，包含：
- 完整的语法规则
- 100+ 个指令示例
- 关键词对照表
- 使用技巧
- 常见问题解答

### README.md 更新
- 重写指令示例章节
- 添加使用技巧
- 增加场景演示
- 更新功能列表

---

## ?? 使用示例

### 组合指令（最大亮点！）
```
去厨房做饭          ? 移动到厨房并开始烹饪
到仓库拿木材        ? 移动到仓库并搬运木材
前往医疗室治疗伤员   ? 移动到医疗室并治疗
去外面打猎          ? 移动到室外并狩猎
到工作台做家具      ? 移动到工作台并制作
```

### 省略格式（智能理解）
```
厨房做饭            ? 自动补充"去"
裁缝台制作衣服      ? 自动识别动作
攻击                ? 自动查找敌人
清洁                ? 自动查找污渍
```

### 工作台指定（精确控制）
```
在裁缝台制作防尘大衣  ? 指定工作台
在锻造台做长剑        ? 指定工作台
炉灶做饭              ? 使用特定设备
```

### 数量控制（批量操作）
```
制作3个木墙           ? 精确数量
做五件衣服            ? 中文数字
生产10个药品          ? 批量生产
```

---

## ?? 技术改进

### 代码优化
- 重构 `CommandParser.cs` (480 行)
- 新增位置查找算法
- 改进关键词匹配逻辑
- 优化性能和内存使用

### 架构改进
```
解析流程：
1. 检测移动动词 → 识别移动意图
2. 提取位置信息 → 查找地图坐标
3. 提取动作类型 → 确定任务类型
4. 提取对象信息 → 查找目标
5. 提取物品数量 → 设置参数
6. AI智能分析   → 备用方案
```

### 兼容性
- ? 向后兼容旧版指令
- ? 支持中英文混用
- ? 保持性能优化
- ? 无破坏性更改

---

## ?? 性能数据

| 指标 | v1.0.0 | v1.1.0 | 变化 |
|------|--------|--------|------|
| DLL 大小 | 45 KB | 50 KB | +5 KB |
| 解析速度 | < 1ms | < 1ms | 无变化 |
| 内存占用 | < 1 MB | < 1 MB | 无变化 |
| 代码行数 | ~1940 | ~2000 | +60 行 |

---

## ?? Bug 修复

1. 修复了某些情况下目标识别失败的问题
2. 改进了工作台匹配算法
3. 优化了数量提取逻辑
4. 修复了位置查找的边界情况

---

## ?? 已知问题

1. **英文指令支持有限**
   - 当前主要优化中文
   - 英文指令可能需要更精确的格式
   - 计划在 v1.2 中改进

2. **复杂房间识别**
   - 某些自定义房间可能无法识别
   - 解决方案：使用建筑名称而非房间名称

3. **特殊物品名称**
   - 部分 Mod 物品可能无法识别
   - 解决方案：使用更具体的描述

---

## ?? 下一步计划

### v1.2 计划 (下一个版本)
- [ ] 指令历史记录
- [ ] 批量指令支持
- [ ] 改进英文支持
- [ ] 添加更多预设位置
- [ ] 优化对话内容

### v1.3 规划
- [ ] 连续指令队列
- [ ] 条件指令（如：如果...就...）
- [ ] 多小人协同指令
- [ ] 自定义关键词系统

---

## ?? 升级方法

### 从 v1.0.0 升级

1. **备份存档**（可选，但推荐）
   ```
   复制存档文件夹
   ```

2. **替换 DLL**
   ```
   删除 Assemblies/ListenToMe.dll
   复制新的 DLL 文件
   ```

3. **重启游戏**
   ```
   重新加载 RimWorld
   ```

4. **测试新功能**
   ```
   尝试输入: "去厨房做饭"
   ```

### 全新安装

按照 [QUICKSTART.md](QUICKSTART.md) 的说明进行安装。

---

## ?? 使用技巧

### 1. 善用移动动词
```
去厨房做饭    → 明确移动意图
厨房做饭      → 也能理解，但不够清晰
```

### 2. 指定工作台
```
在裁缝台制作防尘大衣  → 精确控制
制作防尘大衣          → 自动查找工作台
```

### 3. 使用数量
```
制作3个       → 明确数量
制作          → 默认 1 个
```

### 4. 组合使用
```
去外面狩猎动物      → 移动+动作+对象
到医疗室治疗伤员    → 完整表达
前往工作台做家具    → 清晰指令
```

---

## ?? 感谢

感谢所有测试人员的反馈和建议！

特别感谢提出"自然语法"需求的玩家们，这个功能就是为你们设计的！

---

## ?? 反馈渠道

遇到问题或有建议？

- **GitHub Issues**: 报告 Bug
- **Steam Workshop**: 留言反馈
- **Discord**: 加入讨论

---

## ?? 相关文档

- [README.md](README.md) - 完整功能说明
- [COMMAND_FORMAT.md](COMMAND_FORMAT.md) - 详细指令格式 ? 必读
- [QUICKSTART.md](QUICKSTART.md) - 快速入门
- [BUILD.md](BUILD.md) - 编译指南
- [API.md](API.md) - 开发者文档

---

**享受更自然的指令体验！** ???

*发布时间: 2025-11-23 21:46*  
*版本: v1.1.0*  
*状态: ? 稳定版*
